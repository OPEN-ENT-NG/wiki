<div class="three cell" ng-include="template.containers.sideMenu"></div>

<article ng-if="selectedWiki.page !== undefined" class="nine cell vertical-spacing">
	<div class="row">
		<div class="five cell">
			<h2>[[selectedWiki.page.title]]</h2>
			<em ng-if="selectedWiki.page.modified">
				<i18n>wiki.last.modification.by</i18n> 
				<a href="/userbook/annuaire#/[[selectedWiki.page.author]]">[[selectedWiki.page.authorName]]</a>  
				<i18n>wiki.on</i18n> [[getDateAndTime(selectedWiki.page.modified)]]
			</em>
		</div>
		<div class="seven cell">
			<div class="display-buttons">
				<button ng-click="showDuplicatePageForm()" translate content="wiki.page.duplicate"></button>
				<behaviour name="comment" resource="selectedWiki" class="cell">
					<button ng-click="showCommentForm()" translate content="wiki.comment.add"></button>
				</behaviour>
				<behaviour name="editPage" resource="selectedWiki" class="cell">
					<button ng-click="editPage(selectedWiki)" translate content="wiki.page.edit"></button>
				</behaviour>
				<behaviour name="deletePage" resource="selectedWiki" class="cell">
					<button ng-click="display.showConfirmDeletePage = true;" translate content="wiki.page.delete"></button>
				</behaviour>
			</div>
		</div>
	</div>
	<div class="row">
		<hr />
	</div>
	
	<div bind-html="selectedWiki.page.content" />

	<div class="row content-line">
		<div class="five cell right-magnet">
			<a ng-click="switchCommentsDisplay()" class="medium-text right-magnet">
				<span ng-if="!selectedWiki.page.showComments && selectedWiki.page.comments && selectedWiki.page.comments.length > 0">
					<i18n>wiki.comment.display</i18n> ([[selectedWiki.page.comments.length]])
				</span>
				<span ng-if="selectedWiki.page.showComments && selectedWiki.page.comments && selectedWiki.page.comments.length > 0">
					<i18n>wiki.comment.hide</i18n> ([[selectedWiki.page.comments.length]])
				</span>
			</a>
		</div>
		<div class="clear"></div>
	</div>

	<div class="row" ng-if="selectedWiki.page.showCommentForm === true">
		<div ng-include="template.containers.commentForm"></div>
	</div>

	<div class="row" ng-if="selectedWiki.page.showComments">
		<div class="row" ng-repeat="comment in selectedWiki.page.comments">
			<article class="comment reduce-block-eight">
				<a href="/userbook/annuaire#[[comment.author]]">[[comment.authorName]]</a>
				<em><i18n>wiki.on</i18n> [[formatDate(comment.created)]]</em>
				<a class="cell right-magnet" ng-click="removeComment(comment._id, $index)"
				   ng-if="(comment.author === me.userId || selectedWiki.myRights.deleteWiki)">
					<i18n>wiki.comment.delete</i18n>
				</a>
				<p>[[comment.comment]]</p>
			</article>
		</div>
	</div>
</article>

<!-- Lightbox to confirm page deletion -->
<lightbox show="display.showConfirmDeletePage" on-close="display.showConfirmDeletePage = false">
<h2><i18n>wiki.page.confirmdeleteform.title</i18n></h2>
<p><i18n>wiki.page.confirmdeleteform.message</i18n></p>
<div class="row">
	<button ng-click="deletePage(); display.showConfirmDeletePage = false;" class="right-magnet">
		<i18n>wiki.page.confirmdeleteform.title.delete</i18n>
	</button>
	<button ng-click="display.showConfirmDeletePage = false" class="cancel right-magnet">
		<i18n>wiki.page.confirmdeleteform.title.cancel</i18n>
	</button>
</div>
</lightbox>